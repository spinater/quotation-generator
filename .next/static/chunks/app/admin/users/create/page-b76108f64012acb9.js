(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6538],{63:(e,r,s)=>{"use strict";var t=s(7260);s.o(t,"useRouter")&&s.d(r,{useRouter:function(){return t.useRouter}})},1847:(e,r,s)=>{"use strict";s.d(r,{A:()=>o});var t=s(2115);let a=function(){for(var e=arguments.length,r=Array(e),s=0;s<e;s++)r[s]=arguments[s];return r.filter((e,r,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===r).join(" ").trim()};var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,t.forwardRef)((e,r)=>{let{color:s="currentColor",size:n=24,strokeWidth:o=2,absoluteStrokeWidth:i,className:c="",children:d,iconNode:u,...m}=e;return(0,t.createElement)("svg",{ref:r,...l,width:n,height:n,stroke:s,strokeWidth:i?24*Number(o)/Number(n):o,className:a("lucide",c),...m},[...u.map(e=>{let[r,s]=e;return(0,t.createElement)(r,s)}),...Array.isArray(d)?d:[d]])}),o=(e,r)=>{let s=(0,t.forwardRef)((s,l)=>{let{className:o,...i}=s;return(0,t.createElement)(n,{ref:l,iconNode:r,className:a("lucide-".concat(e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),o),...i})});return s.displayName="".concat(e),s}},5539:(e,r,s)=>{Promise.resolve().then(s.bind(s,9815))},6583:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(1847).A)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]])},9293:(e,r,s)=>{"use strict";s.d(r,{As:()=>i,AuthProvider:()=>o,wC:()=>c});var t=s(5155),a=s(2115),l=s(63);let n=(0,a.createContext)(void 0);function o(e){let{children:r}=e,s=(0,l.useRouter)(),[o,i]=(0,a.useState)(null),[c,d]=(0,a.useState)(!0);(0,a.useEffect)(()=>{u()},[]),(0,a.useEffect)(()=>{if(!o)return;let e=setInterval(()=>{m()},6e5);return()=>clearInterval(e)},[o]),(0,a.useEffect)(()=>{let e;if(!o)return;let r=Date.now(),s=()=>{let e=Date.now();e-r>3e5&&(r=e,m())},t=()=>{clearTimeout(e),e=setTimeout(s,1e3)};return window.addEventListener("mousemove",t),window.addEventListener("keydown",t),window.addEventListener("click",t),window.addEventListener("scroll",t),()=>{clearTimeout(e),window.removeEventListener("mousemove",t),window.removeEventListener("keydown",t),window.removeEventListener("click",t),window.removeEventListener("scroll",t)}},[o]);let u=(0,a.useCallback)(async()=>{try{let e=await fetch("/api/auth/me",{credentials:"include"});if(e.ok){let r=await e.json();i(r.user)}else i(null)}catch(e){console.error("Failed to fetch current user:",e),i(null)}finally{d(!1)}},[]),m=(0,a.useCallback)(async()=>{try{let e=await fetch("/api/auth/refresh",{method:"POST",credentials:"include"});if(e.ok){let r=await e.json();r.refreshed&&(console.log("Token refreshed successfully"),r.user&&i(r.user))}else console.error("Token refresh failed:",e.status),401===e.status&&(i(null),s.push("/login"))}catch(e){console.error("Failed to refresh token:",e)}},[s]),h=async(e,r)=>{d(!0);try{let t=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:r})});if(!t.ok){let e=await t.json();throw Error(e.error||"Login failed")}let a=await t.json();i(a.user),s.push("/"),s.refresh()}catch(e){throw d(!1),e}},x=async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),i(null),s.push("/login"),s.refresh()}catch(e){console.error("Logout failed:",e),i(null),s.push("/login")}},p=async()=>{await u()};return(0,t.jsx)(n.Provider,{value:{user:o,isLoading:c,isAuthenticated:!!o,login:h,logout:x,refreshUser:p,refreshToken:m},children:r})}function i(){let e=(0,a.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function c(){let{user:e,isLoading:r}=i(),s=(0,l.useRouter)();return(0,a.useEffect)(()=>{r||(e?"ADMIN"!==e.role&&s.push("/"):s.push("/login"))},[e,r,s]),{user:e,isLoading:r}}},9815:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>x});var t=s(5155),a=s(2115),l=s(63),n=s(9293),o=s(2619),i=s.n(o),c=s(1847);let d=(0,c.A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),u=(0,c.A)("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),m=(0,c.A)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var h=s(6583);function x(){let e=(0,l.useRouter)(),{user:r,isLoading:s}=(0,n.wC)(),[o,c]=(0,a.useState)({email:"",password:"",name:"",role:"USER"}),[x,p]=(0,a.useState)(!1),[f,b]=(0,a.useState)(""),[y,w]=(0,a.useState)(""),[g,j]=(0,a.useState)(!1),v=async r=>{r.preventDefault(),b(""),w(""),j(!0);try{let r=await fetch("/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(o)}),s=await r.json();if(!r.ok)throw Error(s.error||"Failed to create user");w("User ".concat(s.user.email," created successfully!")),c({email:"",password:"",name:"",role:"USER"}),setTimeout(()=>{e.push("/")},2e3)}catch(e){console.error("Create user error:",e),b(e.message||"Failed to create user. Please try again.")}finally{j(!1)}},N=e=>{c({...o,[e.target.name]:e.target.value})};return s?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,t.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):r&&"ADMIN"===r.role?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 py-8 px-4",children:(0,t.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)(i(),{href:"/",className:"inline-flex items-center text-sm text-blue-600 hover:text-blue-700 mb-4",children:[(0,t.jsx)(d,{className:"w-4 h-4 mr-1"}),"กลับหน้าแรก / Back to Home"]}),(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"สร้างผู้ใช้ใหม่"}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:"Create New User (Admin Only)"})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[f&&(0,t.jsx)("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:(0,t.jsx)("p",{className:"text-sm text-red-600",children:f})}),y&&(0,t.jsxs)("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-md",children:[(0,t.jsx)("p",{className:"text-sm text-green-600",children:y}),(0,t.jsx)("p",{className:"text-xs text-green-500 mt-1",children:"Redirecting to home page..."})]}),(0,t.jsxs)("form",{onSubmit:v,className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:["ชื่อ-นามสกุล / Full Name ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)("input",{id:"name",name:"name",type:"text",required:!0,value:o.name,onChange:N,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"John Doe",disabled:g})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:["อีเมล / Email ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)("input",{id:"email",name:"email",type:"email",required:!0,value:o.email,onChange:N,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"user@example.com",disabled:g})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:["รหัสผ่าน / Password ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("input",{id:"password",name:"password",type:x?"text":"password",required:!0,value:o.password,onChange:N,className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"••••••••",disabled:g}),(0,t.jsx)("button",{type:"button",onClick:()=>p(!x),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:x?(0,t.jsx)(u,{className:"w-5 h-5"}):(0,t.jsx)(m,{className:"w-5 h-5"})})]}),(0,t.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Password must be at least 8 characters with uppercase, lowercase, and number"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 mb-1",children:["บทบาท / Role ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)("select",{id:"role",name:"role",required:!0,value:o.role,onChange:N,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:g,children:[(0,t.jsx)("option",{value:"USER",children:"\uD83D\uDC64 USER - ผู้ใช้ทั่วไป"}),(0,t.jsx)("option",{value:"ADMIN",children:"\uD83D\uDC51 ADMIN - ผู้ดูแลระบบ"})]}),(0,t.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"ADMIN"===o.role?"⚠️ Admin can create users and access all features":"User can create and manage documents"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[(0,t.jsx)(i(),{href:"/",className:"px-4 py-2 text-sm text-gray-700 hover:text-gray-900",children:"ยกเลิก / Cancel"}),(0,t.jsx)("button",{type:"submit",disabled:g,className:"inline-flex items-center px-6 py-2.5 border border-transparent rounded-md shadow-sm text-sm font-medium text-white ".concat(g?"bg-blue-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"),children:g?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"กำลังสร้าง..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.A,{className:"w-5 h-5 mr-2"}),"สร้างผู้ใช้ / Create User"]})})]})]}),(0,t.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-md",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-blue-800 mb-2",children:"\uD83D\uDCDD Password Requirements:"}),(0,t.jsxs)("ul",{className:"text-xs text-blue-700 space-y-1 list-disc list-inside",children:[(0,t.jsx)("li",{children:"Minimum 8 characters"}),(0,t.jsx)("li",{children:"At least one uppercase letter (A-Z)"}),(0,t.jsx)("li",{children:"At least one lowercase letter (a-z)"}),(0,t.jsx)("li",{children:"At least one number (0-9)"})]})]})]})]})}):null}}},e=>{e.O(0,[2619,8441,1255,7358],()=>e(e.s=5539)),_N_E=e.O()}]);