(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7177],{63:(e,t,r)=>{"use strict";var s=r(7260);r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})},778:(e,t,r)=>{"use strict";r.d(t,{default:()=>m});var s=r(5155),a=r(2619),l=r.n(a),n=r(9293),o=r(2115),i=r(6583),c=r(1847);let d=(0,c.A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),u=(0,c.A)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),h=(0,c.A)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);function m(){let{user:e,isAuthenticated:t,logout:r}=(0,n.As)(),[a,c]=(0,o.useState)(!1),m=(0,o.useRef)(null);(0,o.useEffect)(()=>{let e=e=>{m.current&&!m.current.contains(e.target)&&c(!1)};return a&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[a]);let x=async()=>{try{await r()}catch(e){console.error("Logout failed:",e)}};return(0,s.jsx)("header",{className:"bg-white border-b border-gray-200 shadow-sm",children:(0,s.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(l(),{href:"/",className:"flex-1",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900 hover:text-blue-600 transition-colors",children:"\uD83D\uDCCB Thai Quotation & Receipt Generator"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"ระบบสร้างใบเสนอราคาและใบเสร็จรับเงิน"})]}),t&&e?(0,s.jsxs)("div",{className:"relative",ref:m,children:[(0,s.jsxs)("button",{onClick:()=>c(!a),className:"flex items-center space-x-2 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors",children:[(0,s.jsx)("div",{className:"flex items-center justify-center w-8 h-8 bg-blue-600 text-white rounded-full font-semibold",children:e.name.charAt(0).toUpperCase()}),(0,s.jsxs)("div",{className:"text-left",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"ADMIN"===e.role?"\uD83D\uDC51 Admin":"\uD83D\uDC64 User"})]}),(0,s.jsx)("svg",{className:"w-4 h-4 text-gray-500 transition-transform ".concat(a?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),a&&(0,s.jsxs)("div",{className:"absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50",children:[(0,s.jsxs)("div",{className:"px-4 py-3 border-b border-gray-200",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:e.email}),(0,s.jsx)("span",{className:"inline-block mt-2 px-2 py-1 text-xs font-semibold rounded ".concat("ADMIN"===e.role?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"),children:"ADMIN"===e.role?"\uD83D\uDC51 Administrator":"\uD83D\uDC64 User"})]}),(0,s.jsxs)("div",{className:"py-2",children:["ADMIN"===e.role&&(0,s.jsxs)(l(),{href:"/admin/users/create",className:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors",onClick:()=>c(!1),children:[(0,s.jsx)(i.A,{className:"w-4 h-4 mr-3"}),"สร้างผู้ใช้ใหม่ / Create User"]}),(0,s.jsxs)(l(),{href:"/profile",className:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors",onClick:()=>c(!1),children:[(0,s.jsx)(d,{className:"w-4 h-4 mr-3"}),"โปรไฟล์ / Profile"]}),(0,s.jsxs)(l(),{href:"/settings",className:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors",onClick:()=>c(!1),children:[(0,s.jsx)(u,{className:"w-4 h-4 mr-3"}),"ตั้งค่า / Settings"]})]}),(0,s.jsx)("div",{className:"border-t border-gray-200 pt-2",children:(0,s.jsxs)("button",{onClick:x,className:"flex items-center w-full px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors",children:[(0,s.jsx)(h,{className:"w-4 h-4 mr-3"}),"ออกจากระบบ / Logout"]})})]})]}):(0,s.jsx)(l(),{href:"/login",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"เข้าสู่ระบบ / Login"})]})})})}},1290:()=>{},1847:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var s=r(2115);let a=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,s.forwardRef)((e,t)=>{let{color:r="currentColor",size:n=24,strokeWidth:o=2,absoluteStrokeWidth:i,className:c="",children:d,iconNode:u,...h}=e;return(0,s.createElement)("svg",{ref:t,...l,width:n,height:n,stroke:r,strokeWidth:i?24*Number(o)/Number(n):o,className:a("lucide",c),...h},[...u.map(e=>{let[t,r]=e;return(0,s.createElement)(t,r)}),...Array.isArray(d)?d:[d]])}),o=(e,t)=>{let r=(0,s.forwardRef)((r,l)=>{let{className:o,...i}=r;return(0,s.createElement)(n,{ref:l,iconNode:t,className:a("lucide-".concat(e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),o),...i})});return r.displayName="".concat(e),r}},6583:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(1847).A)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]])},8652:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,1290,23)),Promise.resolve().then(r.bind(r,778)),Promise.resolve().then(r.bind(r,9293))},9293:(e,t,r)=>{"use strict";r.d(t,{As:()=>i,AuthProvider:()=>o,wC:()=>c});var s=r(5155),a=r(2115),l=r(63);let n=(0,a.createContext)(void 0);function o(e){let{children:t}=e,r=(0,l.useRouter)(),[o,i]=(0,a.useState)(null),[c,d]=(0,a.useState)(!0);(0,a.useEffect)(()=>{u()},[]),(0,a.useEffect)(()=>{if(!o)return;let e=setInterval(()=>{h()},6e5);return()=>clearInterval(e)},[o]),(0,a.useEffect)(()=>{let e;if(!o)return;let t=Date.now(),r=()=>{let e=Date.now();e-t>3e5&&(t=e,h())},s=()=>{clearTimeout(e),e=setTimeout(r,1e3)};return window.addEventListener("mousemove",s),window.addEventListener("keydown",s),window.addEventListener("click",s),window.addEventListener("scroll",s),()=>{clearTimeout(e),window.removeEventListener("mousemove",s),window.removeEventListener("keydown",s),window.removeEventListener("click",s),window.removeEventListener("scroll",s)}},[o]);let u=(0,a.useCallback)(async()=>{try{let e=await fetch("/api/auth/me",{credentials:"include"});if(e.ok){let t=await e.json();i(t.user)}else i(null)}catch(e){console.error("Failed to fetch current user:",e),i(null)}finally{d(!1)}},[]),h=(0,a.useCallback)(async()=>{try{let e=await fetch("/api/auth/refresh",{method:"POST",credentials:"include"});if(e.ok){let t=await e.json();t.refreshed&&(console.log("Token refreshed successfully"),t.user&&i(t.user))}else console.error("Token refresh failed:",e.status),401===e.status&&(i(null),r.push("/login"))}catch(e){console.error("Failed to refresh token:",e)}},[r]),m=async(e,t)=>{d(!0);try{let s=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:t})});if(!s.ok){let e=await s.json();throw Error(e.error||"Login failed")}let a=await s.json();i(a.user),r.push("/"),r.refresh()}catch(e){throw d(!1),e}},x=async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),i(null),r.push("/login"),r.refresh()}catch(e){console.error("Logout failed:",e),i(null),r.push("/login")}},f=async()=>{await u()};return(0,s.jsx)(n.Provider,{value:{user:o,isLoading:c,isAuthenticated:!!o,login:m,logout:x,refreshUser:f,refreshToken:h},children:t})}function i(){let e=(0,a.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function c(){let{user:e,isLoading:t}=i(),r=(0,l.useRouter)();return(0,a.useEffect)(()=>{t||(e?"ADMIN"!==e.role&&r.push("/"):r.push("/login"))},[e,t,r]),{user:e,isLoading:t}}}},e=>{e.O(0,[1741,2619,8441,1255,7358],()=>e(e.s=8652)),_N_E=e.O()}]);