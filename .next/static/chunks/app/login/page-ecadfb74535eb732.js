(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4520],{63:(e,t,s)=>{"use strict";var r=s(7260);s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}})},2459:(e,t,s)=>{Promise.resolve().then(s.bind(s,5404))},5404:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var r=s(5155),l=s(2115),a=s(63),n=s(2619),o=s.n(n),i=s(9293);function c(){let e=(0,a.useRouter)(),{user:t,login:s,isLoading:n}=(0,i.As)(),[c,d]=(0,l.useState)(""),[u,m]=(0,l.useState)(""),[h,x]=(0,l.useState)(""),[f,b]=(0,l.useState)(!1);(0,l.useEffect)(()=>{t&&!n&&e.push("/")},[t,n,e]);let p=async e=>{e.preventDefault(),x(""),b(!0);try{await s(c,u)}catch(e){console.error("Login error:",e),x(e.message||"Failed to login. Please try again."),b(!1)}};return n?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 px-4",children:(0,r.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"ระบบจัดการใบเสนอราคา"}),(0,r.jsx)("p",{className:"text-lg text-gray-600",children:"Quotation & Receipt Generator"})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-8",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 text-center",children:"เข้าสู่ระบบ"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 text-center mt-1",children:"Sign in to your account"})]}),h&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:(0,r.jsx)("p",{className:"text-sm text-red-600",children:h})}),(0,r.jsxs)("form",{onSubmit:p,className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"อีเมล / Email"}),(0,r.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:c,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"your@email.com",disabled:f})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"รหัสผ่าน / Password"}),(0,r.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:u,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"••••••••",disabled:f})]}),(0,r.jsx)("div",{children:(0,r.jsx)("button",{type:"submit",disabled:f,className:"w-full flex justify-center py-2.5 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white ".concat(f?"bg-blue-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"),children:f?(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"กำลังเข้าสู่ระบบ..."]}):"เข้าสู่ระบบ / Sign In"})})]}),(0,r.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-md",children:[(0,r.jsx)("p",{className:"text-xs font-semibold text-blue-800 mb-2",children:"\uD83D\uDD10 Default Admin Credentials:"}),(0,r.jsxs)("p",{className:"text-xs text-blue-700",children:["Email: ",(0,r.jsx)("span",{className:"font-mono",children:"admin@example.com"})]}),(0,r.jsxs)("p",{className:"text-xs text-blue-700",children:["Password: ",(0,r.jsx)("span",{className:"font-mono",children:"Admin123!"})]}),(0,r.jsx)("p",{className:"text-xs text-blue-600 mt-2",children:"⚠️ Please change the password after first login!"})]})]}),(0,r.jsx)("div",{className:"text-center text-sm text-gray-600",children:(0,r.jsx)(o(),{href:"/",className:"font-medium text-blue-600 hover:text-blue-500",children:"← กลับหน้าแรก / Back to Home"})})]})})}},9293:(e,t,s)=>{"use strict";s.d(t,{As:()=>i,AuthProvider:()=>o,wC:()=>c});var r=s(5155),l=s(2115),a=s(63);let n=(0,l.createContext)(void 0);function o(e){let{children:t}=e,s=(0,a.useRouter)(),[o,i]=(0,l.useState)(null),[c,d]=(0,l.useState)(!0);(0,l.useEffect)(()=>{u()},[]),(0,l.useEffect)(()=>{if(!o)return;let e=setInterval(()=>{m()},6e5);return()=>clearInterval(e)},[o]),(0,l.useEffect)(()=>{let e;if(!o)return;let t=Date.now(),s=()=>{let e=Date.now();e-t>3e5&&(t=e,m())},r=()=>{clearTimeout(e),e=setTimeout(s,1e3)};return window.addEventListener("mousemove",r),window.addEventListener("keydown",r),window.addEventListener("click",r),window.addEventListener("scroll",r),()=>{clearTimeout(e),window.removeEventListener("mousemove",r),window.removeEventListener("keydown",r),window.removeEventListener("click",r),window.removeEventListener("scroll",r)}},[o]);let u=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/auth/me",{credentials:"include"});if(e.ok){let t=await e.json();i(t.user)}else i(null)}catch(e){console.error("Failed to fetch current user:",e),i(null)}finally{d(!1)}},[]),m=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/auth/refresh",{method:"POST",credentials:"include"});if(e.ok){let t=await e.json();t.refreshed&&(console.log("Token refreshed successfully"),t.user&&i(t.user))}else console.error("Token refresh failed:",e.status),401===e.status&&(i(null),s.push("/login"))}catch(e){console.error("Failed to refresh token:",e)}},[s]),h=async(e,t)=>{d(!0);try{let r=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:t})});if(!r.ok){let e=await r.json();throw Error(e.error||"Login failed")}let l=await r.json();i(l.user),s.push("/"),s.refresh()}catch(e){throw d(!1),e}},x=async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),i(null),s.push("/login"),s.refresh()}catch(e){console.error("Logout failed:",e),i(null),s.push("/login")}},f=async()=>{await u()};return(0,r.jsx)(n.Provider,{value:{user:o,isLoading:c,isAuthenticated:!!o,login:h,logout:x,refreshUser:f,refreshToken:m},children:t})}function i(){let e=(0,l.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function c(){let{user:e,isLoading:t}=i(),s=(0,a.useRouter)();return(0,l.useEffect)(()=>{t||(e?"ADMIN"!==e.role&&s.push("/"):s.push("/login"))},[e,t,s]),{user:e,isLoading:t}}}},e=>{e.O(0,[2619,8441,1255,7358],()=>e(e.s=2459)),_N_E=e.O()}]);