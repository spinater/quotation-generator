"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[773],{773:(e,t,s)=>{s.d(t,{InvoiceForm:()=>h});var a=s(5155),i=s(2115),r=s(63),n=s(86),l=s(926);let d=(0,l.createServerReference)("40897318af1e0cb57035dd3b4b1394e88fd70024e9",l.callServer,void 0,l.findSourceMapURL,"createInvoice");var c=s(1653),m=s(6191),o=s(4033),u=s(7937),x=s(1360);function h(e){let{companies:t,defaultCompanyId:s,editMode:l=!1,initialData:h}=e,g=(0,r.useRouter)(),[p,b]=(0,i.useState)(!1),[j,v]=(0,i.useState)({}),[y,N]=(0,i.useState)(new Set),[f,D]=(0,i.useState)(()=>!!((null==h?void 0:h.signatureName)||(null==h?void 0:h.signatureTitle)||(null==h?void 0:h.signatureUrl))),[I,T]=(0,i.useState)(""),C=new Date,w=new Date(C);w.setDate(C.getDate()+30);let[S,U]=(0,i.useState)(()=>{var e;return h?{...h,issueDate:"string"==typeof h.issueDate?h.issueDate:new Date(h.issueDate).toISOString().split("T")[0],dueDate:h.dueDate?"string"==typeof h.dueDate?h.dueDate:new Date(h.dueDate).toISOString().split("T")[0]:""}:{companyId:s||(null==(e=t[0])?void 0:e.id)||"",customerName:"",customerAddress:"",customerTaxId:"",customerPhone:"",issueDate:C.toISOString().split("T")[0],dueDate:w.toISOString().split("T")[0],items:[{id:crypto.randomUUID(),description:"",quantity:1,unit:"ชิ้น",pricePerUnit:0,amount:0,order:0,subItems:[]}],hasVat:!0,hasWithholdingTax:!1,withholdingTaxPercent:3,notes:"",language:"th",signatureUrl:"",signatureName:"",signatureTitle:""}}),P=S.items.reduce((e,t)=>e+t.amount,0),A=S.hasVat?.07*P:0,k=P+A,q=S.hasWithholdingTax?P*(S.withholdingTaxPercent/100):0,F=k-q,L=(0,c.Vn)(F);(0,i.useEffect)(()=>{U(e=>({...e,items:e.items.map(e=>({...e,amount:e.quantity*e.pricePerUnit}))}))},[]);let O=(e,t)=>{U(s=>({...s,[e]:t}))},W=(e,t)=>{U(s=>({...s,[e]:t}))},E=(e,t,s)=>{U(a=>({...a,items:a.items.map(a=>{if(a.id===e){let e={...a,[t]:s};return("quantity"===t||"pricePerUnit"===t)&&(e.amount=e.quantity*e.pricePerUnit),e}return a})}))},V=(e,t,s,a)=>{U(i=>({...i,items:i.items.map(i=>i.id===e&&i.subItems?{...i,subItems:i.subItems.map(e=>{if(e.id===t){let t={...e,[s]:a};return("quantity"===s||"pricePerUnit"===s)&&(t.amount=t.quantity*t.pricePerUnit),t}return e})}:i)}))},H=async e=>{e.preventDefault(),b(!0),v({});try{let e={};if(S.companyId||(e.companyId="Please select a company"),S.customerName.trim()||(e.customerName="Customer name is required"),S.customerAddress.trim()||(e.customerAddress="Customer address is required"),0===S.items.length&&(e.items="At least one item is required"),Object.keys(e).length>0){v(e),b(!1);return}let t=await d({...S,issueDate:new Date(S.issueDate),dueDate:S.dueDate?new Date(S.dueDate):void 0,subtotal:P,vatAmount:A,total:k,withholdingTaxAmount:q,netTotal:F});t.success&&t.invoice?g.push("/invoice/".concat(t.invoice.id)):v({submit:t.error||"Failed to create invoice"})}catch(e){console.error("Error submitting invoice:",e),v({submit:e instanceof Error?e.message:"An error occurred"})}finally{b(!1)}},R=t.find(e=>e.id===S.companyId),Z=t.filter(e=>e.isIssuer),_=t.filter(e=>e.isCustomer);return(0,a.jsxs)("form",{onSubmit:H,className:"space-y-8",children:[(0,a.jsx)(n.Zp,{children:(0,a.jsxs)(n.yj,{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"ข้อมูลบริษัท / Company Information"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(n.l6,{label:"บริษัท / Company",value:S.companyId,onChange:e=>{U(t=>({...t,companyId:e.target.value}))},required:!0,error:j.companyId,options:Z.map(e=>({value:e.id,label:"".concat(e.name).concat(e.isDefault?" (Default)":"")}))}),R&&(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 text-sm",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:R.name}),R.nameEn&&(0,a.jsx)("p",{className:"text-gray-700",children:R.nameEn}),(0,a.jsxs)("p",{className:"text-gray-600 mt-2",children:["Tax ID: ",R.taxId]}),(0,a.jsx)("p",{className:"text-gray-600",children:R.address}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Tel: ",R.phone]}),R.email&&(0,a.jsxs)("p",{className:"text-gray-600",children:["Email: ",R.email]})]})]})]})}),(0,a.jsx)(n.Zp,{children:(0,a.jsxs)(n.yj,{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"ข้อมูลลูกค้า / Customer Information"}),_.length>0&&(0,a.jsxs)("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,a.jsx)(n.l6,{label:"เลือกจากบริษัทลูกค้า / Select from Customer Companies (Optional)",value:I,onChange:e=>{let s=e.target.value;if(T(s),s){let e=t.find(e=>e.id===s);e&&U(t=>({...t,customerName:e.name,customerAddress:e.address,customerTaxId:e.taxId,customerPhone:e.phone}))}},options:[{value:"",label:"-- กรอกข้อมูลเอง / Manual Entry --"},..._.map(e=>({value:e.id,label:e.name}))]}),(0,a.jsx)("p",{className:"text-sm text-blue-700 mt-2",children:"\uD83D\uDCA1 เลือกจากรายชื่อบริษัทลูกค้าที่บันทึกไว้ หรือกรอกข้อมูลด้านล่างเอง"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)(n.pd,{label:"ชื่อลูกค้า / Customer Name",value:S.customerName,onChange:e=>O("customerName",e.target.value),required:!0,error:j.customerName,placeholder:"บริษัท ABC จำกัด"}),(0,a.jsx)(n.pd,{label:"เลขประจำตัวผู้เสียภาษี / Tax ID (Optional)",value:S.customerTaxId,onChange:e=>O("customerTaxId",e.target.value),placeholder:"0123456789012"})]}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(n.fs,{label:"ที่อยู่ / Address",value:S.customerAddress,onChange:e=>O("customerAddress",e.target.value),required:!0,error:j.customerAddress,rows:3,placeholder:"123 ถนนสุขุมวิท แขวงคลองเตย เขตคลองเตย กรุงเทพฯ 10110"})}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(n.pd,{label:"เบอร์โทรศัพท์ / Phone (Optional)",value:S.customerPhone,onChange:e=>O("customerPhone",e.target.value),placeholder:"02-123-4567"})})]})}),(0,a.jsx)(n.Zp,{children:(0,a.jsxs)(n.yj,{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"รายละเอียดใบแจ้งหนี้ / Invoice Details"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)(n.pd,{type:"date",label:"วันที่ออกใบแจ้งหนี้ / Issue Date",value:"string"==typeof S.issueDate?S.issueDate:new Date(S.issueDate).toISOString().split("T")[0],onChange:e=>W("issueDate",e.target.value),required:!0}),(0,a.jsx)(n.pd,{type:"date",label:"วันครบกำหนดชำระ / Due Date (Optional)",value:S.dueDate?"string"==typeof S.dueDate?S.dueDate:new Date(S.dueDate).toISOString().split("T")[0]:"",onChange:e=>W("dueDate",e.target.value)})]})]})}),(0,a.jsx)(n.Zp,{children:(0,a.jsxs)(n.yj,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"รายการสินค้า/บริการ / Items"}),(0,a.jsxs)(n.$n,{type:"button",onClick:()=>{let e={id:crypto.randomUUID(),description:"",quantity:1,unit:"ชิ้น",pricePerUnit:0,amount:0,order:S.items.length,subItems:[]};U(t=>({...t,items:[...t.items,e]}))},variant:"secondary",children:[(0,a.jsx)(m.A,{className:"w-4 h-4 mr-2"}),"เพิ่มรายการ / Add Item"]})]}),j.items&&(0,a.jsx)("div",{className:"bg-red-50 text-red-600 p-3 rounded-lg mb-4",children:j.items}),(0,a.jsx)("div",{className:"space-y-4",children:S.items.map((e,t)=>(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsxs)("h3",{className:"font-medium text-gray-900",children:["Item ",t+1]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[e.subItems&&e.subItems.length>0&&(0,a.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.id,void N(e=>{let s=new Set(e);return s.has(t)?s.delete(t):s.add(t),s})},className:"text-gray-600 hover:text-gray-900",children:y.has(e.id)?(0,a.jsx)(o.A,{className:"w-5 h-5"}):(0,a.jsx)(u.A,{className:"w-5 h-5"})}),S.items.length>1&&(0,a.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.id,void U(e=>({...e,items:e.items.filter(e=>e.id!==t)}))},className:"text-red-600 hover:text-red-800",children:(0,a.jsx)(x.A,{className:"w-5 h-5"})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,a.jsx)(n.fs,{label:"รายละเอียด / Description",value:e.description,onChange:t=>E(e.id,"description",t.target.value),rows:2,placeholder:"รายละเอียดสินค้าหรือบริการ"}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-3",children:[(0,a.jsx)(n.pd,{type:"number",label:"จำนวน / Qty",value:e.quantity,onChange:t=>E(e.id,"quantity",parseFloat(t.target.value)||0),step:"0.01",min:"0"}),(0,a.jsx)(n.pd,{label:"หน่วย / Unit",value:e.unit,onChange:t=>E(e.id,"unit",t.target.value),placeholder:"ชิ้น"}),(0,a.jsx)(n.pd,{type:"number",label:"ราคา/หน่วย / Price",value:e.pricePerUnit,onChange:t=>E(e.id,"pricePerUnit",parseFloat(t.target.value)||0),step:"0.01",min:"0"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"จำนวนเงิน / Amount"}),(0,a.jsxs)("div",{className:"px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg text-right font-medium",children:["฿",e.amount.toLocaleString("th-TH",{minimumFractionDigits:2})]})]})]})]}),y.has(e.id)&&e.subItems&&e.subItems.length>0&&(0,a.jsx)("div",{className:"mt-4 ml-6 space-y-3 border-l-2 border-gray-200 pl-4",children:e.subItems.map((t,s)=>(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:["Sub-item ",s+1]}),(0,a.jsx)("button",{type:"button",onClick:()=>{var s,a;return s=e.id,a=t.id,void U(e=>({...e,items:e.items.map(e=>e.id===s&&e.subItems?{...e,subItems:e.subItems.filter(e=>e.id!==a)}:e)}))},className:"text-red-600 hover:text-red-800",children:(0,a.jsx)(x.A,{className:"w-4 h-4"})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-3",children:[(0,a.jsx)(n.fs,{label:"รายละเอียด",value:t.description,onChange:s=>V(e.id,t.id,"description",s.target.value),rows:2}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-2",children:[(0,a.jsx)(n.pd,{type:"number",label:"จำนวน",value:t.quantity,onChange:s=>V(e.id,t.id,"quantity",parseFloat(s.target.value)||0),step:"0.01",min:"0"}),(0,a.jsx)(n.pd,{label:"หน่วย",value:t.unit,onChange:s=>V(e.id,t.id,"unit",s.target.value)}),(0,a.jsx)(n.pd,{type:"number",label:"ราคา/หน่วย",value:t.pricePerUnit,onChange:s=>V(e.id,t.id,"pricePerUnit",parseFloat(s.target.value)||0),step:"0.01",min:"0"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"จำนวนเงิน"}),(0,a.jsxs)("div",{className:"px-2 py-1 bg-white border border-gray-300 rounded text-right text-sm font-medium",children:["฿",t.amount.toLocaleString("th-TH",{minimumFractionDigits:2})]})]})]})]})]},t.id))}),(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsxs)("button",{type:"button",onClick:()=>{var t;return t=e.id,void U(e=>({...e,items:e.items.map(e=>{if(e.id===t){let t=e.subItems||[],s={id:crypto.randomUUID(),description:"",quantity:1,unit:"ชิ้น",pricePerUnit:0,amount:0,order:t.length,subItems:[]};return{...e,subItems:[...t,s]}}return e})}))},className:"text-sm text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[(0,a.jsx)(m.A,{className:"w-4 h-4"}),"เพิ่ม Sub-item"]})})]},e.id))})]})}),(0,a.jsx)(n.Zp,{children:(0,a.jsxs)(n.yj,{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"สรุปยอดรวม / Summary"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"flex items-center justify-between py-3 border-b border-gray-200",children:(0,a.jsxs)("label",{className:"flex items-center cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:S.hasVat,onChange:()=>{U(e=>({...e,hasVat:!e.hasVat}))},className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"}),(0,a.jsx)("span",{className:"ml-3 text-gray-900 font-medium",children:"รวม VAT 7% / Include VAT 7%"})]})}),(0,a.jsxs)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,a.jsxs)("label",{className:"flex items-center cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:S.hasWithholdingTax,onChange:()=>{U(e=>({...e,hasWithholdingTax:!e.hasWithholdingTax}))},className:"w-5 h-5 text-orange-600 rounded focus:ring-orange-500"}),(0,a.jsx)("span",{className:"ml-3 text-gray-900 font-medium",children:"หัก ณ ที่จ่าย / Withholding Tax"})]})}),S.hasWithholdingTax&&(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsx)(n.pd,{type:"number",label:"เปอร์เซ็นต์หัก ณ ที่จ่าย / Withholding Tax %",value:S.withholdingTaxPercent,onChange:e=>(e=>{let t=parseFloat(e)||0;U(e=>({...e,withholdingTaxPercent:t}))})(e.target.value),step:"0.01",min:"0",max:"100"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:["ยอดหัก ณ ที่จ่าย:"," ",(0,a.jsxs)("span",{className:"font-bold text-orange-600",children:["฿",q.toLocaleString("th-TH",{minimumFractionDigits:2})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-3 text-lg",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-700",children:"ยอดรวม / Subtotal:"}),(0,a.jsxs)("span",{className:"font-semibold",children:["฿",P.toLocaleString("th-TH",{minimumFractionDigits:2})]})]}),S.hasVat&&(0,a.jsxs)("div",{className:"flex justify-between text-gray-600",children:[(0,a.jsx)("span",{children:"VAT 7%:"}),(0,a.jsxs)("span",{children:["฿",A.toLocaleString("th-TH",{minimumFractionDigits:2})]})]}),(0,a.jsxs)("div",{className:"flex justify-between pt-2 border-t border-gray-300",children:[(0,a.jsx)("span",{className:"text-gray-700",children:"ยอดรวมทั้งสิ้น / Total:"}),(0,a.jsxs)("span",{className:"font-bold text-xl",children:["฿",k.toLocaleString("th-TH",{minimumFractionDigits:2})]})]}),S.hasWithholdingTax&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex justify-between text-orange-600",children:[(0,a.jsxs)("span",{children:["หัก ณ ที่จ่าย ",S.withholdingTaxPercent,"%:"]}),(0,a.jsxs)("span",{className:"font-semibold",children:["-฿",q.toLocaleString("th-TH",{minimumFractionDigits:2})]})]}),(0,a.jsxs)("div",{className:"flex justify-between pt-2 border-t-2 border-gray-400 text-purple-700",children:[(0,a.jsx)("span",{className:"font-bold",children:"ยอดสุทธิ / Net Total:"}),(0,a.jsxs)("span",{className:"font-bold text-2xl",children:["฿",F.toLocaleString("th-TH",{minimumFractionDigits:2})]})]})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 pt-2 border-t border-gray-200",children:[(0,a.jsx)("span",{className:"font-medium",children:S.hasWithholdingTax?"ยอดสุทธิ (ตัวอักษร) / Net Total in Words:":"ยอดรวม (ตัวอักษร) / Total in Words:"}),(0,a.jsx)("p",{className:"mt-1 text-base font-medium text-gray-900",children:L})]})]})]})]})}),(0,a.jsx)(n.Zp,{children:(0,a.jsxs)(n.yj,{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"หมายเหตุ / Notes (Optional)"}),(0,a.jsx)(n.fs,{value:S.notes,onChange:e=>U(t=>({...t,notes:e.target.value})),rows:4,placeholder:"เงื่อนไขการชำระเงิน หรือหมายเหตุเพิ่มเติม..."})]})}),(0,a.jsx)(n.Zp,{children:(0,a.jsx)(n.yj,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"flex items-center justify-between py-3 border-b border-gray-200",children:(0,a.jsxs)("label",{className:"flex items-center cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:f,onChange:e=>{D(e.target.checked),e.target.checked||U(e=>({...e,signatureName:"",signatureTitle:"",signatureUrl:""}))},className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"}),(0,a.jsx)("span",{className:"ml-3 text-gray-900 font-medium",children:"ต้องการลายเซ็น / Require Signature"})]})}),f&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"ลายเซ็น / Signature"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(n.JU,{htmlFor:"signatureName",children:"ชื่อผู้อนุมัติ / Approver Name"}),(0,a.jsx)(n.pd,{id:"signatureName",name:"signatureName",value:S.signatureName||"",onChange:e=>U(t=>({...t,signatureName:e.target.value})),placeholder:"นายสมชาย ใจดี"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(n.JU,{htmlFor:"signatureTitle",children:"ตำแหน่ง / Position"}),(0,a.jsx)(n.pd,{id:"signatureTitle",name:"signatureTitle",value:S.signatureTitle||"",onChange:e=>U(t=>({...t,signatureTitle:e.target.value})),placeholder:"ผู้จัดการ"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)(n.JU,{htmlFor:"signatureUrl",children:"URL ลายเซ็น / Signature URL"}),(0,a.jsx)(n.pd,{id:"signatureUrl",name:"signatureUrl",value:S.signatureUrl||"",onChange:e=>U(t=>({...t,signatureUrl:e.target.value})),placeholder:"https://example.com/signature.png"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"ใส่ URL ของรูปลายเซ็น (ถ้ามี) / Enter signature image URL (if available)"})]})]})]})]})})}),j.submit&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,a.jsx)("p",{className:"text-red-600",children:j.submit})}),(0,a.jsxs)("div",{className:"flex gap-4 justify-end",children:[(0,a.jsx)(n.$n,{type:"button",variant:"secondary",onClick:()=>g.back(),disabled:p,children:"ยกเลิก / Cancel"}),(0,a.jsx)(n.$n,{type:"submit",disabled:p,isLoading:p,children:p?"กำลังบันทึก...":l?"บันทึกการแก้ไข / Save Changes":"สร้างใบแจ้งหนี้ / Create Invoice"})]})]})}}}]);