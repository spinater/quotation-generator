"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4189],{4189:(e,t,s)=>{s.d(t,{QuotationForm:()=>h});var a=s(5155),r=s(2115),i=s(63),n=s(86),l=s(926);let d=(0,l.createServerReference)("40592cf63791fbf1c24959648485218fa71d9e7a6b",l.callServer,void 0,l.findSourceMapURL,"createQuotation");var o=s(1653),c=s(6191),m=s(1360),u=s(4033),p=s(7937);function h(e){let{companies:t,defaultCompanyId:s,editMode:l=!1,initialData:h}=e,x=(0,i.useRouter)(),[g,b]=(0,r.useState)(!1),[v,j]=(0,r.useState)({}),[y,f]=(0,r.useState)(new Set),N=new Date,I=new Date(N);I.setDate(N.getDate()+30);let[C,D]=(0,r.useState)(()=>{var e;return h?{...h,issueDate:"string"==typeof h.issueDate?h.issueDate:new Date(h.issueDate).toISOString().split("T")[0],validUntil:"string"==typeof h.validUntil?h.validUntil:new Date(h.validUntil).toISOString().split("T")[0]}:{companyId:s||(null==(e=t[0])?void 0:e.id)||"",customerName:"",customerAddress:"",customerTaxId:"",customerPhone:"",issueDate:N.toISOString().split("T")[0],validUntil:I.toISOString().split("T")[0],items:[{id:crypto.randomUUID(),description:"",quantity:1,unit:"ชิ้น",pricePerUnit:0,amount:0,order:0,subItems:[]}],hasVat:!0,notes:"",language:"th"}}),U=C.items.reduce((e,t)=>e+t.amount,0),S=C.hasVat?.07*U:0,q=U+S,w=(0,o.Vn)(q);(0,r.useEffect)(()=>{D(e=>({...e,items:e.items.map(e=>({...e,amount:e.quantity*e.pricePerUnit}))}))},[]);let A=(e,t)=>{D(s=>({...s,[e]:t})),v[e]&&j(t=>{let s={...t};return delete s[e],s})},P=(e,t,s)=>{D(a=>({...a,items:a.items.map(a=>{if(a.id===e){let e={...a,[t]:s};return("quantity"===t||"pricePerUnit"===t)&&(e.amount=e.quantity*e.pricePerUnit),e}return a})}))},T=(e,t,s,a)=>{D(r=>({...r,items:r.items.map(r=>r.id===e&&r.subItems?{...r,subItems:r.subItems.map(e=>{if(e.id===t){let t={...e,[s]:a};return("quantity"===s||"pricePerUnit"===s)&&(t.amount=t.quantity*t.pricePerUnit),t}return e})}:r)}))},k=async e=>{e.preventDefault(),b(!0),j({});try{let e=await d(C);e.success&&e.data?x.push("/quotation/".concat(e.data.id)):(j({form:e.error||"Failed to create quotation"}),b(!1))}catch(e){console.error("Error submitting form:",e),j({form:"An unexpected error occurred"}),b(!1)}};return(0,a.jsxs)("form",{onSubmit:k,className:"space-y-6",children:[v.form&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:v.form}),(0,a.jsx)(n.Zp,{title:"ข้อมูลบริษัท / Company Information",children:(0,a.jsx)(n.l6,{label:"บริษัท / Company",value:C.companyId,onChange:e=>A("companyId",e.target.value),options:t.map(e=>({value:e.id,label:e.name})),required:!0,error:v.companyId})}),(0,a.jsxs)(n.Zp,{title:"ข้อมูลลูกค้า / Customer Information",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)(n.pd,{label:"ชื่อลูกค้า / Customer Name",value:C.customerName,onChange:e=>A("customerName",e.target.value),placeholder:"บริษัท ABC จำกัด",required:!0,error:v.customerName}),(0,a.jsx)(n.pd,{label:"เลขประจำตัวผู้เสียภาษี / Tax ID",value:C.customerTaxId,onChange:e=>A("customerTaxId",e.target.value),placeholder:"0000000000000",error:v.customerTaxId})]}),(0,a.jsx)(n.fs,{label:"ที่อยู่ / Address",value:C.customerAddress,onChange:e=>A("customerAddress",e.target.value),placeholder:"123 ถนนสุขุมวิท แขวงคลองเตย เขตคลองเตย กรุงเทพฯ 10110",required:!0,rows:3,error:v.customerAddress}),(0,a.jsx)(n.pd,{label:"เบอร์โทรศัพท์ / Phone",value:C.customerPhone,onChange:e=>A("customerPhone",e.target.value),placeholder:"02-123-4567",type:"tel",error:v.customerPhone})]}),(0,a.jsx)(n.Zp,{title:"ข้อมูลเอกสาร / Document Information",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)(n.pd,{label:"วันที่ / Issue Date",type:"date",value:String(C.issueDate),onChange:e=>A("issueDate",e.target.value),required:!0,error:v.issueDate}),(0,a.jsx)(n.pd,{label:"ใช้ได้ถึงวันที่ / Valid Until",type:"date",value:String(C.validUntil),onChange:e=>A("validUntil",e.target.value),required:!0,error:v.validUntil})]})}),(0,a.jsx)(n.Zp,{title:"รายการสินค้า/บริการ / Items",headerAction:(0,a.jsxs)(n.$n,{type:"button",size:"sm",onClick:()=>{let e={id:crypto.randomUUID(),description:"",quantity:1,unit:"ชิ้น",pricePerUnit:0,amount:0,order:C.items.length,subItems:[]};D(t=>({...t,items:[...t.items,e]}))},children:[(0,a.jsx)(c.A,{className:"w-4 h-4 mr-2"}),"เพิ่มรายการ"]}),children:(0,a.jsx)("div",{className:"space-y-4",children:C.items.map((e,t)=>(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsxs)("h4",{className:"font-medium text-gray-900",children:["รายการที่ ",t+1]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:C.items.length>1&&(0,a.jsx)(n.$n,{type:"button",variant:"danger",size:"sm",onClick:()=>{var t;return t=e.id,void D(e=>({...e,items:e.items.filter(e=>e.id!==t)}))},children:(0,a.jsx)(m.A,{className:"w-4 h-4"})})})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(n.fs,{label:"รายละเอียด / Description",value:e.description,onChange:t=>P(e.id,"description",t.target.value),placeholder:"อธิบายรายละเอียดสินค้า/บริการ",required:!0,rows:2}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[(0,a.jsx)(n.pd,{label:"จำนวน / Quantity",type:"number",value:e.quantity,onChange:t=>P(e.id,"quantity",parseFloat(t.target.value)||0),min:"0",step:"0.01",required:!0}),(0,a.jsx)(n.pd,{label:"หน่วย / Unit",value:e.unit,onChange:t=>P(e.id,"unit",t.target.value),placeholder:"ชิ้น",required:!0}),(0,a.jsx)(n.pd,{label:"ราคา/หน่วย / Price/Unit",type:"number",value:e.pricePerUnit,onChange:t=>P(e.id,"pricePerUnit",parseFloat(t.target.value)||0),min:"0",step:"0.01",required:!0}),(0,a.jsx)(n.pd,{label:"จำนวนเงิน / Amount",type:"number",value:e.amount.toFixed(2),disabled:!0,className:"bg-gray-100"})]}),(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsxs)(n.$n,{type:"button",variant:"ghost",size:"sm",onClick:()=>(e=>{let t={id:crypto.randomUUID(),description:"",quantity:1,unit:"ชิ้น",pricePerUnit:0,amount:0,order:0,parentItemId:e};D(s=>({...s,items:s.items.map(s=>s.id===e?{...s,subItems:[...s.subItems||[],t]}:s)})),f(t=>new Set(t).add(e))})(e.id),children:[(0,a.jsx)(c.A,{className:"w-4 h-4 mr-2"}),"เพิ่มรายการย่อย"]}),e.subItems&&e.subItems.length>0&&(0,a.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>{var t;return t=e.id,void f(e=>{let s=new Set(e);return s.has(t)?s.delete(t):s.add(t),s})},className:"flex items-center text-sm text-gray-600 hover:text-gray-900",children:[y.has(e.id)?(0,a.jsx)(u.A,{className:"w-4 h-4 mr-1"}):(0,a.jsx)(p.A,{className:"w-4 h-4 mr-1"}),"รายการย่อย (",e.subItems.length,")"]}),y.has(e.id)&&(0,a.jsx)("div",{className:"ml-6 space-y-3 border-l-2 border-gray-300 pl-4",children:e.subItems.map((t,s)=>(0,a.jsxs)("div",{className:"bg-white p-3 rounded border border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:["รายการย่อยที่ ",s+1]}),(0,a.jsx)(n.$n,{type:"button",variant:"danger",size:"sm",onClick:()=>{var s,a;return s=e.id,a=t.id,void D(e=>({...e,items:e.items.map(e=>e.id===s&&e.subItems?{...e,subItems:e.subItems.filter(e=>e.id!==a)}:e)}))},children:(0,a.jsx)(m.A,{className:"w-4 h-4"})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n.pd,{label:"รายละเอียด",value:t.description,onChange:s=>T(e.id,t.id,"description",s.target.value),placeholder:"รายละเอียดย่อย",required:!0}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsx)(n.pd,{label:"จำนวน",type:"number",value:t.quantity,onChange:s=>T(e.id,t.id,"quantity",parseFloat(s.target.value)||0),min:"0",step:"0.01",required:!0}),(0,a.jsx)(n.pd,{label:"หน่วย",value:t.unit,onChange:s=>T(e.id,t.id,"unit",s.target.value),placeholder:"ชิ้น",required:!0})]})]})]},t.id))})]})]})]})]},e.id))})}),(0,a.jsx)(n.Zp,{title:"สรุปยอดรวม / Summary",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between py-2 border-b",children:[(0,a.jsx)("span",{className:"text-gray-700",children:"ยอดรวม / Subtotal:"}),(0,a.jsxs)("span",{className:"font-semibold text-lg",children:[U.toLocaleString("th-TH",{minimumFractionDigits:2,maximumFractionDigits:2})," ","บาท"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("input",{type:"checkbox",id:"hasVat",checked:C.hasVat,onChange:e=>A("hasVat",e.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),(0,a.jsx)("label",{htmlFor:"hasVat",className:"text-gray-700",children:"รวมภาษีมูลค่าเพิ่ม 7% / Include VAT 7%"})]}),C.hasVat&&(0,a.jsxs)("div",{className:"flex items-center justify-between py-2 border-b",children:[(0,a.jsx)("span",{className:"text-gray-700",children:"ภาษีมูลค่าเพิ่ม 7% / VAT 7%:"}),(0,a.jsxs)("span",{className:"font-semibold",children:[S.toLocaleString("th-TH",{minimumFractionDigits:2,maximumFractionDigits:2})," ","บาท"]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between py-3 border-t-2 border-gray-300",children:[(0,a.jsx)("span",{className:"text-lg font-bold text-gray-900",children:"รวมทั้งสิ้น / Total:"}),(0,a.jsxs)("span",{className:"text-2xl font-bold text-blue-600",children:[q.toLocaleString("th-TH",{minimumFractionDigits:2,maximumFractionDigits:2})," ","บาท"]})]}),(0,a.jsxs)("div",{className:"bg-blue-50 p-3 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-gray-700 mb-1",children:"ตัวอักษร / In Words:"}),(0,a.jsx)("p",{className:"font-medium text-gray-900",children:w})]})]})}),(0,a.jsx)(n.Zp,{title:"หมายเหตุ / Notes (Optional)",children:(0,a.jsx)(n.fs,{value:C.notes||"",onChange:e=>A("notes",e.target.value),placeholder:"หมายเหตุเพิ่มเติม...",rows:3})}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-4 pt-6 border-t",children:[(0,a.jsx)(n.$n,{type:"button",variant:"ghost",onClick:()=>x.back(),disabled:g,children:"ยกเลิก / Cancel"}),(0,a.jsx)(n.$n,{type:"submit",isLoading:g,disabled:g,children:g?"กำลังบันทึก...":"บันทึกใบเสนอราคา / Save Quotation"})]})]})}}}]);